# 前端开发规范文档

# 一、目标

统一代码风格、命名规范，增强代码可读性和可维护性，供日常开发工作中参考，以提高团队协作的开发效率。

# 二、编程规约

## 2.1 命名规约

1. 【强制】项目文件夹及文件命名使用小写字母，多个单词用中划线分隔

```
// 正确示例
user-management/
  - user-list.vue
  - user-detail.vue
  - user-edit.vue

// 错误示例
UserManagement/
  - UserList.vue
  - user_detail.vue
  - userEdit.vue
```

1. 【强制】Vue 组件命名采用 PascalCase（大驼峰），组件文件名与组件名保持一致

```
// 正确示例 - UserProfile.vue
<script setup lang="ts">
defineOptions({
  name: 'UserProfile'
})
</script>

// 正确示例 - 在模板中使用
<template>
  <UserProfile />
  <!-- 或 -->
  <user-profile />
</template>

// 错误示例
<script setup lang="ts">
defineOptions({
  name: 'userProfile'  // 错误：应使用PascalCase
})
</script>
```

1. 【强制】变量、函数命名使用 camelCase（小驼峰），常量使用 UPPER_SNAKE_CASE

```typescript
// 正确示例
const userName = 'John'
const userAge = 25
const MAX_RETRY_COUNT = 3
const API_BASE_URL = 'https://api.example.com'

function getUserInfo() {
  // ...
}

async function fetchUserData(userId: string) {
  // ...
}

// 错误示例
const user_name = 'John'  // 错误：应使用camelCase
const UserAge = 25        // 错误：应使用camelCase
const maxRetryCount = 3   // 错误：常量应使用UPPER_SNAKE_CASE
```

1. 【强制】接口命名使用 PascalCase，并以 I 开头；类型别名使用 PascalCase

```typescript
// 正确示例
interface IUserInfo {
  id: string
  name: string
  email: string
}

interface IApiResponse<T = any> {
  code: number
  data: T
  message: string
}

type UserRole = 'admin' | 'user' | 'guest'

type UserStatus = 'active' | 'inactive' | 'banned'

// 错误示例
interface userInfo {  // 错误：应使用PascalCase并以I开头
  id: string
}

type user_role = 'admin' | 'user'  // 错误：应使用PascalCase
```

1. 【推荐】布尔类型的变量或函数使用 is、has、can、should 等前缀

```typescript
// 正确示例
const isLoading = ref(false)
const hasPermission = computed(() => user.role === 'admin')
const canEdit = ref(true)
const shouldShowModal = ref(false)

function isValidEmail(email: string): boolean {
  return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)
}

// 可接受但不够清晰
const loading = ref(false)
const permission = ref(true)
```

1. 【推荐】事件处理函数使用 handle 或 on 前缀

```typescript
// 正确示例
const handleClick = () => {
  console.log('clicked')
}

const handleSubmit = async (formData: IFormData) => {
  await submitForm(formData)
}

const onUserLogin = (user: IUserInfo) => {
  store.commit('setUser', user)
}

// 不推荐
const click = () => {  // 不够清晰
  console.log('clicked')
}

const submit = () => {  // 不够清晰
  // ...
}
```

1. 【强制】Uniapp 页面和组件遵循 Vue 命名规范

```
// 正确示例 - Uniapp项目结构
pages/
  user/
    - user-list.vue
    - user-detail.vue
  order/
    - order-list.vue
    - order-detail.vue

components/
  - UserCard.vue
  - OrderItem.vue
  - NavigationBar.vue

// pages.json配置
{
  "pages": [
    {
      "path": "pages/user/user-list",
      "style": {
        "navigationBarTitleText": "用户列表"
      }
    }
  ]
}
```

## 2.2 常量定义

1. 【强制】常量统一在 config 或 constants 文件中定义，按模块分类

```typescript
// 正确示例 - src/constants/api.ts
export const API_BASE_URL = import.meta.env.VITE_API_BASE_URL || 'https://api.example.com'
export const API_TIMEOUT = 30000
export const MAX_UPLOAD_SIZE = 5 * 1024 * 1024 // 5MB

// src/constants/user.ts
export const USER_ROLES = {
  ADMIN: 'admin',
  USER: 'user',
  GUEST: 'guest'
} as const

export const USER_STATUS = {
  ACTIVE: 'active',
  INACTIVE: 'inactive',
  BANNED: 'banned'
} as const

export type UserRole = typeof USER_ROLES[keyof typeof USER_ROLES]
export type UserStatus = typeof USER_STATUS[keyof typeof USER_STATUS]

// 使用示例
import { API_BASE_URL, USER_ROLES } from '@/constants'

const apiUrl = `${API_BASE_URL}/users`
const adminRole = USER_ROLES.ADMIN
```

1. 【推荐】使用枚举(enum)定义一组相关的常量

```typescript
// 正确示例
export enum HttpStatus {
  OK = 200,
  CREATED = 201,
  BAD_REQUEST = 400,
  UNAUTHORIZED = 401,
  FORBIDDEN = 403,
  NOT_FOUND = 404,
  INTERNAL_SERVER_ERROR = 500
}

export enum OrderStatus {
  PENDING = 'pending',
  PROCESSING = 'processing',
  COMPLETED = 'completed',
  CANCELLED = 'cancelled'
}

// 使用示例
if (response.status === HttpStatus.OK) {
  // 处理成功响应
}

const order = {
  id: '123',
  status: OrderStatus.PENDING
}
```

1. 【强制】环境变量统一使用.env 文件管理，并提供.env.example 模板

```bash
# 正确示例 - .env.example (Vue.js/Vite项目)
# API配置
VITE_API_BASE_URL=https://api.example.com
VITE_API_TIMEOUT=30000

# 应用配置
VITE_APP_TITLE=我的应用
VITE_APP_VERSION=1.0.0

# 第三方服务
VITE_WECHAT_APPID=wx1234567890

# 正确使用
// vite.config.ts 或组件中
const apiBaseUrl = import.meta.env.VITE_API_BASE_URL
const appTitle = import.meta.env.VITE_APP_TITLE
```

```bash
# Uniapp项目环境变量
# .env.development
VUE_APP_API_BASE_URL=https://dev-api.example.com
VUE_APP_ENV=development

# .env.production
VUE_APP_API_BASE_URL=https://api.example.com
VUE_APP_ENV=production

# 使用示例
const apiBaseUrl = process.env.VUE_APP_API_BASE_URL
```

1. 【推荐】定义全局类型常量，统一管理类型定义

```typescript
// 正确示例 - src/types/global.d.ts
export interface IPageParams {
  page: number
  pageSize: number
  total?: number
}

export interface IPaginationResponse<T> {
  data: T[]
  pagination: {
    page: number
    pageSize: number
    total: number
    totalPages: number
  }
}

export interface IApiResponse<T = any> {
  code: number
  data: T
  message: string
  timestamp: number
}

// src/types/user.d.ts
export interface IUser {
  id: string
  email: string
  userName: string
  role: UserRole
  status: UserStatus
  createdAt: Date
  updatedAt: Date
}

export interface ILoginParams {
  email: string
  password: string
}

export interface ILoginResponse {
  user: IUser
  token: string
  refreshToken: string
}
```

1. 【强制】Uniapp 小程序配置常量独立管理

```typescript
// 正确示例 - src/config/wechat.ts
export const WECHAT_CONFIG = {
  APPID: process.env.VUE_APP_WECHAT_APPID || '',
  // 小程序页面路径
  PAGES: {
    HOME: '/pages/index/index',
    USER_CENTER: '/pages/user/user-center',
    LOGIN: '/pages/auth/login'
  },
  // 分享配置
  SHARE: {
    TITLE: '分享标题',
    IMAGE_URL: '/static/share-image.png'
  }
}

// 使用示例
uni.navigateTo({
  url: WECHAT_CONFIG.PAGES.USER_CENTER
})
```

## 2.3 控制语句

1. 【强制】使用===和!==进行比较，避免使用==和!=

```typescript
// 正确示例
if (value === null) {
  // ...
}

if (status !== 'active') {
  // ...
}

if (count === 0) {
  // ...
}

// 错误示例
if (value == null) {  // 错误：应使用===
  // ...
}

if (status != 'active') {  // 错误：应使用!==
  // ...
}
```

1. 【强制】复杂的条件判断应提取为函数，提高可读性

```typescript
// 正确示例
function canUserEdit(user: IUser, post: IPost): boolean {
  return user.role === 'admin' || 
         (user.id === post.authorId && post.status === 'draft')
}

if (canUserEdit(currentUser, post)) {
  // 允许编辑
}

// 不推荐
if (currentUser.role === 'admin' || 
    (currentUser.id === post.authorId && post.status === 'draft')) {
  // 条件过于复杂，难以理解
}
```

1. 【推荐】使用可选链(?.)和空值合并运算符(??)简化代码

```typescript
// 正确示例
const userName = user?.profile?.name ?? 'Guest'
const userAge = user?.profile?.age ?? 0

// API响应处理
const data = response?.data?.result ?? []

// Uniapp中使用
const systemInfo = uni.getSystemInfoSync()
const statusBarHeight = systemInfo?.statusBarHeight ?? 0

// 不推荐（但可接受）
const userName = user && user.profile && user.profile.name ? user.profile.name : 'Guest'
```

1. 【强制】避免在条件语句中赋值

```typescript
// 正确示例
const user = await findUser(userId)
if (user) {
  // 使用user
}

// 错误示例
if (user = await findUser(userId)) {  // 错误：容易与比较混淆
  // 使用user
}
```

1. 【推荐】使用早返回(early return)减少嵌套层级

```typescript
// 正确示例
async function processUser(userId: string) {
  if (!userId) {
    return null
  }
  
  const user = await findUser(userId)
  if (!user) {
    return null
  }
  
  if (user.status !== 'active') {
    return null
  }
  
  return updateUserData(user)
}

// 不推荐
async function processUser(userId: string) {
  if (userId) {
    const user = await findUser(userId)
    if (user) {
      if (user.status === 'active') {
        return updateUserData(user)
      }
    }
  }
  return null
}
```

1. 【推荐】switch 语句必须包含 default 分支

```typescript
// 正确示例
function getStatusText(status: OrderStatus): string {
  switch (status) {
    case OrderStatus.PENDING:
      return '待处理'
    case OrderStatus.PROCESSING:
      return '处理中'
    case OrderStatus.COMPLETED:
      return '已完成'
    case OrderStatus.CANCELLED:
      return '已取消'
    default:
      return '未知状态'
  }
}
```

## 2.4 集合处理

1. 【推荐】优先使用数组的高阶函数(map、filter、reduce 等)而非 for 循环

```typescript
// 正确示例
const activeUsers = users.filter(user => user.status === 'active')
const userNames = users.map(user => user.userName)
const totalAge = users.reduce((sum, user) => sum + user.age, 0)

// 链式调用
const result = users
  .filter(user => user.status === 'active')
  .map(user => ({
    id: user.id,
    name: user.userName
  }))
  .slice(0, 10)

// 不推荐（但某些场景下可接受）
const activeUsers = []
for (let i = 0; i < users.length; i++) {
  if (users[i].status === 'active') {
    activeUsers.push(users[i])
  }
}
```

1. 【强制】避免在循环中进行异步操作，使用 Promise.all 或 for...of

```typescript
// 正确示例 - 并行处理
const userIds = ['id1', 'id2', 'id3']
const users = await Promise.all(
  userIds.map(id => fetchUser(id))
)

// 正确示例 - 串行处理
const results = []
for (const userId of userIds) {
  const user = await fetchUser(userId)
  results.push(user)
}

// 错误示例
const results = []
userIds.forEach(async (userId) => {  // 错误：forEach不会等待异步操作
  const user = await fetchUser(userId)
  results.push(user)
})
```

1. 【推荐】使用 Set 进行去重，使用 Map 存储键值对

```typescript
// 正确示例 - 数组去重
const uniqueIds = [...new Set(ids)]

// 正确示例 - 统计计数
const countMap = new Map<string, number>()
items.forEach(item => {
  countMap.set(item.id, (countMap.get(item.id) || 0) + 1)
})

// 正确示例 - 快速查找
const userMap = new Map(users.map(user => [user.id, user]))
const user = userMap.get(userId)

// 不推荐
const uniqueIds = ids.filter((id, index) => ids.indexOf(id) === index)
```

1. 【推荐】处理大数据集时注意性能优化

```typescript
// 正确示例 - 虚拟列表处理大量数据
import { ref, computed } from 'vue'

const allData = ref<IItem[]>([])  // 假设有10000条数据
const scrollTop = ref(0)
const itemHeight = 50
const containerHeight = 600
const visibleCount = Math.ceil(containerHeight / itemHeight)

const visibleData = computed(() => {
  const startIndex = Math.floor(scrollTop.value / itemHeight)
  return allData.value.slice(startIndex, startIndex + visibleCount + 5)
})

const handleScroll = (event: any) => {
  scrollTop.value = event.detail.scrollTop
}

// Uniapp中的虚拟列表
// 使用uni-ui的uni-list-item组件
```

1. 【强制】检查数组是否为空再进行操作

```typescript
// 正确示例
if (users && users.length > 0) {
  const firstUser = users[0]
  // 处理数据
}

// 使用可选链
const firstUser = users?.[0]
if (firstUser) {
  // 处理数据
}

// 错误示例
const firstUser = users[0]  // 可能undefined
firstUser.name  // 可能报错
```

## 2.5 状态管理

1. 【强制】避免在多个组件间共享可变状态，使用 Vuex/Pinia 进行状态管理

```typescript
// 正确示例 - 使用Pinia store (Vue.js)
// stores/user.ts
import { defineStore } from 'pinia'

export const useUserStore = defineStore('user', {
  state: () => ({
    currentUser: null as IUser | null,
    isLoggedIn: false
  }),
  
  getters: {
    userName: (state) => state.currentUser?.userName || 'Guest',
    userRole: (state) => state.currentUser?.role
  },
  
  actions: {
    setUser(user: IUser) {
      this.currentUser = user
      this.isLoggedIn = true
    },
    
    logout() {
      this.currentUser = null
      this.isLoggedIn = false
      localStorage.removeItem('token')
    }
  }
})

// 在组件中使用
<script setup lang="ts">
import { useUserStore } from '@/stores/user'

const userStore = useUserStore()

const handleLogin = async () => {
  const user = await login(credentials)
  userStore.setUser(user)
}
</script>

// 错误示例 - 全局变量
let globalUser: IUser | null = null  // 错误：避免使用全局可变变量

export function setGlobalUser(user: IUser) {
  globalUser = user
}
```

1. 【强制】Uniapp 使用 Vuex 进行全局状态管理

```typescript
// 正确示例 - Uniapp Vuex配置
// store/index.ts
import { createStore } from 'vuex'

interface IState {
  user: IUser | null
  token: string
  systemInfo: any
}

export default createStore<IState>({
  state: {
    user: null,
    token: uni.getStorageSync('token') || '',
    systemInfo: null
  },
  
  mutations: {
    SET_USER(state, user: IUser) {
      state.user = user
    },
    
    SET_TOKEN(state, token: string) {
      state.token = token
      uni.setStorageSync('token', token)
    },
    
    SET_SYSTEM_INFO(state, info: any) {
      state.systemInfo = info
    }
  },
  
  actions: {
    async login({ commit }, credentials) {
      const res = await uni.$http.post('/auth/login', credentials)
      commit('SET_USER', res.data.user)
      commit('SET_TOKEN', res.data.token)
    },
    
    logout({ commit }) {
      commit('SET_USER', null)
      commit('SET_TOKEN', '')
      uni.removeStorageSync('token')
      uni.reLaunch({ url: '/pages/auth/login' })
    }
  }
})

// 在页面中使用
<script setup lang="ts">
import { useStore } from 'vuex'

const store = useStore()

const handleLogin = () => {
  store.dispatch('login', credentials)
}
</script>
```

1. 【推荐】使用组合式 API 管理局部状态

```typescript
// 正确示例 - 使用composables管理复用逻辑
// composables/useUserList.ts
import { ref, computed } from 'vue'

export function useUserList() {
  const users = ref<IUser[]>([])
  const loading = ref(false)
  const searchKeyword = ref('')
  
  const filteredUsers = computed(() => {
    if (!searchKeyword.value) return users.value
    return users.value.filter(user => 
      user.userName.includes(searchKeyword.value)
    )
  })
  
  const fetchUsers = async () => {
    loading.value = true
    try {
      const res = await api.get('/users')
      users.value = res.data
    } finally {
      loading.value = false
    }
  }
  
  return {
    users,
    loading,
    searchKeyword,
    filteredUsers,
    fetchUsers
  }
}

// 在组件中使用
<script setup lang="ts">
import { useUserList } from '@/composables/useUserList'

const { users, loading, searchKeyword, filteredUsers, fetchUsers } = useUserList()

onMounted(() => {
  fetchUsers()
})
</script>
```

1. 【推荐】合理使用本地存储(localStorage/sessionStorage)

```typescript
// 正确示例 - 封装存储工具类
// utils/storage.ts
export const storage = {
  set(key: string, value: any) {
    try {
      const data = JSON.stringify(value)
      localStorage.setItem(key, data)
    } catch (error) {
      console.error('Storage set error:', error)
    }
  },
  
  get<T = any>(key: string, defaultValue?: T): T | null {
    try {
      const data = localStorage.getItem(key)
      return data ? JSON.parse(data) : defaultValue ?? null
    } catch (error) {
      console.error('Storage get error:', error)
      return defaultValue ?? null
    }
  },
  
  remove(key: string) {
    localStorage.removeItem(key)
  },
  
  clear() {
    localStorage.clear()
  }
}

// Uniapp存储工具
export const uniStorage = {
  set(key: string, value: any) {
    try {
      uni.setStorageSync(key, value)
    } catch (error) {
      console.error('Storage set error:', error)
    }
  },
  
  get<T = any>(key: string, defaultValue?: T): T | null {
    try {
      return uni.getStorageSync(key) || defaultValue ?? null
    } catch (error) {
      console.error('Storage get error:', error)
      return defaultValue ?? null
    }
  },
  
  remove(key: string) {
    uni.removeStorageSync(key)
  },
  
  clear() {
    uni.clearStorageSync()
  }
}

// 使用示例
import { storage } from '@/utils/storage'

const user = storage.get<IUser>('user')
storage.set('user', userData)
```

## 2.6 API 请求处理

1. 【强制】统一封装 API 请求，使用拦截器处理通用逻辑

```typescript
// 正确示例 - Vue.js axios封装
// utils/request.ts
import axios from 'axios'
import { ElMessage } from 'element-plus'
import router from '@/router'
import { storage } from './storage'

const request = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL,
  timeout: 30000
})

// 请求拦截器
request.interceptors.request.use(
  config => {
    const token = storage.get('token')
    if (token) {
      config.headers.Authorization = `Bearer ${token}`
    }
    return config
  },
  error => {
    return Promise.reject(error)
  }
)

// 响应拦截器
request.interceptors.response.use(
  response => {
    const res = response.data
    
    // 根据业务code判断
    if (res.code !== 200) {
      ElMessage.error(res.message || '请求失败')
      return Promise.reject(new Error(res.message || 'Error'))
    }
    
    return res
  },
  error => {
    let message = '请求失败，请稍后重试'
    
    if (error.response) {
      const { status, data } = error.response
      
      switch (status) {
        case 401:
          message = '未授权，请重新登录'
          storage.remove('token')
          router.push('/login')
          break
        case 403:
          message = '没有权限访问'
          break
        case 404:
          message = '请求的资源不存在'
          break
        case 500:
          message = '服务器错误'
          break
        default:
          message = data.message || message
      }
    } else if (error.request) {
      message = '网络连接失败，请检查网络'
    }
    
    ElMessage.error(message)
    return Promise.reject(error)
  }
)

export default request
```

1. 【强制】Uniapp 请求封装

```typescript
// 正确示例 - Uniapp请求封装
// utils/request.ts
import { uniStorage } from './storage'

interface IRequestOptions {
  url: string
  method?: 'GET' | 'POST' | 'PUT' | 'DELETE'
  data?: any
  header?: any
}

class Request {
  private baseURL: string
  private timeout: number
  
  constructor() {
    this.baseURL = process.env.VUE_APP_API_BASE_URL || ''
    this.timeout = 30000
  }
  
  request<T = any>(options: IRequestOptions): Promise<T> {
    return new Promise((resolve, reject) => {
      const token = uniStorage.get('token')
      
      uni.request({
        url: this.baseURL + options.url,
        method: options.method || 'GET',
        data: options.data,
        header: {
          'Content-Type': 'application/json',
          'Authorization': token ? `Bearer ${token}` : '',
          ...options.header
        },
        timeout: this.timeout,
        success: (res: any) => {
          const data = res.data
          
          // 业务状态码判断
          if (data.code === 200) {
            resolve(data)
          } else if (data.code === 401) {
            uni.showToast({
              title: '请先登录',
              icon: 'none'
            })
            uniStorage.remove('token')
            uni.reLaunch({ url: '/pages/auth/login' })
            reject(new Error(data.message))
          } else {
            uni.showToast({
              title: data.message || '请求失败',
              icon: 'none'
            })
            reject(new Error(data.message))
          }
        },
        fail: (error) => {
          uni.showToast({
            title: '网络请求失败',
            icon: 'none'
          })
          reject(error)
        }
      })
    })
  }
  
  get<T = any>(url: string, data?: any) {
    return this.request<T>({ url, method: 'GET', data })
  }
  
  post<T = any>(url: string, data?: any) {
    return this.request<T>({ url, method: 'POST', data })
  }
  
  put<T = any>(url: string, data?: any) {
    return this.request<T>({ url, method: 'PUT', data })
  }
  
  delete<T = any>(url: string, data?: any) {
    return this.request<T>({ url, method: 'DELETE', data })
  }
}

export default new Request()

// 使用示例
import request from '@/utils/request'

const userList = await request.get('/users')
const user = await request.post('/users', { name: 'John' })
```

1. 【推荐】API 接口统一管理

```typescript
// 正确示例 - API模块化管理
// api/user.ts
import request from '@/utils/request'

export const userApi = {
  // 获取用户列表
  getList(params: IPageParams) {
    return request.get<IPaginationResponse<IUser>>('/users', params)
  },
  
  // 获取用户详情
  getDetail(id: string) {
    return request.get<IApiResponse<IUser>>(`/users/${id}`)
  },
  
  // 创建用户
  create(data: ICreateUserDto) {
    return request.post<IApiResponse<IUser>>('/users', data)
  },
  
  // 更新用户
  update(id: string, data: IUpdateUserDto) {
    return request.put<IApiResponse<IUser>>(`/users/${id}`, data)
  },
  
  // 删除用户
  delete(id: string) {
    return request.delete<IApiResponse<void>>(`/users/${id}`)
  }
}

// api/index.ts
export * from './user'
export * from './order'
export * from './product'

// 使用示例
import { userApi } from '@/api'

const fetchUsers = async () => {
  const res = await userApi.getList({ page: 1, pageSize: 20 })
  users.value = res.data
}
```

## 2.7 注释规范

1. 【强制】类、接口、重要函数必须添加 JSDoc 注释

```typescript
/**
 * 用户列表组件
 * 
 * 功能：
 * - 展示用户列表
 * - 支持分页
 * - 支持搜索和筛选
 * 
 * @author zhangsan
 * @since 2025-10-01
 */
export default defineComponent({
  name: 'UserList',
  setup() {
    /**
     * 获取用户列表
     * @param params - 分页参数
     * @returns 用户列表响应
     */
    const fetchUsers = async (params: IPageParams) => {
      // 实现逻辑
    }
    
    return {
      fetchUsers
    }
  }
})

/**
 * 用户信息接口
 */
export interface IUser {
  /** 用户唯一标识 */
  id: string
  /** 用户邮箱 */
  email: string
  /** 用户名 */
  userName: string
  /** 创建时间 */
  createdAt: Date
}
```

1. 【推荐】复杂的业务逻辑添加必要的行内注释

```typescript
// 正确示例
async function calculateOrderTotal(orderId: string): Promise<number> {
  const order = await getOrderDetail(orderId)
  
  if (!order) {
    return 0
  }
  
  // 计算商品总价
  const subtotal = order.items.reduce((sum, item) => {
    return sum + item.price * item.quantity
  }, 0)
  
  // 应用折扣（如果有）
  const discount = order.couponId 
    ? await calculateDiscount(order.couponId, subtotal)
    : 0
  
  // 计算运费（满100免运费）
  const shippingFee = subtotal >= 100 ? 0 : 10
  
  // 最终金额 = 小计 - 折扣 + 运费
  return subtotal - discount + shippingFee
}
```

1. 【强制】TODO、FIXME、HACK 等标记必须包含说明和负责人

```typescript
// 正确示例
// TODO(zhangsan): 需要添加缓存机制以提升性能 - 2025-10-20
async function getPopularPosts() {
  return await api.get('/posts/popular')
}

// FIXME(lisi): 此处可能存在内存泄漏，需要在组件卸载时清理 - 2025-10-18
onMounted(() => {
  timer = setInterval(() => {
    // 定时任务
  }, 1000)
})

// HACK(wangwu): 临时方案，等待后端API修复后移除 - 2025-10-16
const userData = response.data || response.result || {}
```

1. 【推荐】Vue 组件添加组件说明注释

```
<!--
  用户卡片组件
  
  功能：
  - 展示用户基本信息
  - 支持点击跳转到用户详情
  
  @author zhangsan
  @since 2025-10-01
-->
<template>
  <div class="user-card" @click="handleClick">
    <img :src="user.avatar" class="avatar" />
    <div class="info">
      <h3>{{ user.userName }}</h3>
      <p>{{ user.email }}</p>
    </div>
  </div>
</template>

<script setup lang="ts">
interface Props {
  /** 用户信息 */
  user: IUser
}

const props = defineProps<Props>()

const emit = defineEmits<{
  click: [user: IUser]
}>()

const handleClick = () => {
  emit('click', props.user)
}
</script>
```

## 2.8 异常处理

1. 【强制】使用 try-catch 捕获异步操作的异常

```typescript
// 正确示例
async function fetchUserData(userId: string) {
  try {
    const response = await api.get(`/users/${userId}`)
    return response.data
  } catch (error) {
    console.error('获取用户数据失败:', error)
    ElMessage.error('获取用户数据失败')
    throw error
  }
}

// Vue组件中
const handleSubmit = async () => {
  try {
    await submitForm(formData.value)
    ElMessage.success('提交成功')
  } catch (error) {
    ElMessage.error('提交失败，请重试')
    console.error('提交表单失败:', error)
  }
}

// 错误示例
async function fetchUserData(userId: string) {
  const response = await api.get(`/users/${userId}`)  // 错误：没有错误处理
  return response.data
}
```

1. 【推荐】Uniapp 中统一处理错误提示

```typescript
// 正确示例 - 错误处理工具
// utils/error-handler.ts
export function handleError(error: any, customMessage?: string) {
  console.error('Error:', error)
  
  const message = customMessage || error.message || '操作失败'
  
  uni.showToast({
    title: message,
    icon: 'none',
    duration: 2000
  })
}

// 使用示例
import { handleError } from '@/utils/error-handler'

const handleSubmit = async () => {
  try {
    await submitOrder(orderData)
    uni.showToast({
      title: '提交成功',
      icon: 'success'
    })
  } catch (error) {
    handleError(error, '提交订单失败')
  }
}
```

1. 【推荐】使用错误边界处理组件错误

```
<!-- 正确示例 - 错误边界组件 -->
<!-- components/ErrorBoundary.vue -->
<template>
  <div v-if="error" class="error-boundary">
    <div class="error-content">
      <h2>出错了</h2>
      <p>{{ error.message }}</p>
      <button @click="handleReset">重试</button>
    </div>
  </div>
  <slot v-else />
</template>

<script setup lang="ts">
import { ref, onErrorCaptured } from 'vue'

const error = ref<Error | null>(null)

onErrorCaptured((err) => {
  error.value = err
  console.error('组件错误:', err)
  return false  // 阻止错误继续传播
})

function handleReset() {
  error.value = null
}
</script>

<style scoped>
.error-boundary {
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 400px;
  padding: 20px;
}

.error-content {
  text-align: center;
}

.error-content h2 {
  color: #f56c6c;
  margin-bottom: 10px;
}

.error-content button {
  margin-top: 20px;
  padding: 8px 16px;
  background: #409eff;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}
</style>

<!-- 使用示例 -->
<template>
  <ErrorBoundary>
    <UserList />
  </ErrorBoundary>
</template>
```

1. 【强制】防止重复提交，使用防抖节流

```typescript
// 正确示例 - 防抖处理
import { useDebounceFn } from '@vueuse/core'

const isSubmitting = ref(false)

const handleSubmit = useDebounceFn(async () => {
  if (isSubmitting.value) return
  
  isSubmitting.value = true
  try {
    await submitForm(formData.value)
    ElMessage.success('提交成功')
  } catch (error) {
    ElMessage.error('提交失败')
  } finally {
    isSubmitting.value = false
  }
}, 500)

// Uniapp中的防抖
let timer: any = null

const handleSearch = (keyword: string) => {
  if (timer) clearTimeout(timer)
  
  timer = setTimeout(() => {
    performSearch(keyword)
  }, 300)
}
```

1. 【推荐】表单验证错误友好提示

```
<!-- 正确示例 - 表单验证 -->
<template>
  <el-form :model="form" :rules="rules" ref="formRef">
    <el-form-item label="邮箱" prop="email">
      <el-input v-model="form.email" />
    </el-form-item>
    
    <el-form-item label="密码" prop="password">
      <el-input v-model="form.password" type="password" />
    </el-form-item>
    
    <el-form-item>
      <el-button type="primary" @click="handleSubmit">提交</el-button>
    </el-form-item>
  </el-form>
</template>

<script setup lang="ts">
import { ref, reactive } from 'vue'
import type { FormInstance, FormRules } from 'element-plus'

const formRef = ref<FormInstance>()

const form = reactive({
  email: '',
  password: ''
})

const rules: FormRules = {
  email: [
    { required: true, message: '请输入邮箱', trigger: 'blur' },
    { type: 'email', message: '请输入有效的邮箱地址', trigger: 'blur' }
  ],
  password: [
    { required: true, message: '请输入密码', trigger: 'blur' },
    { min: 6, message: '密码长度不能少于6位', trigger: 'blur' }
  ]
}

const handleSubmit = async () => {
  if (!formRef.value) return
  
  try {
    await formRef.value.validate()
    // 验证通过，提交表单
    await submitForm(form)
    ElMessage.success('提交成功')
  } catch (error) {
    console.error('表单验证失败:', error)
  }
}
</script>
```

# 三、参考资料

- [Vue.js 官方风格指南](https://cn.vuejs.org/style-guide/)
- [TypeScript 编码规范](https://google.github.io/styleguide/tsguide.html)
- [Uniapp 官方文档](https://uniapp.dcloud.net.cn/)
- [Airbnb JavaScript Style Guide](https://github.com/airbnb/javascript)
- [VueUse - Vue 组合式 API 工具集](https://vueuse.org/)
- [Element Plus 组件库](https://element-plus.org/)
- [Vant 移动端组件库](https://vant-ui.github.io/vant/)

---
