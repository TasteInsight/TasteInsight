# 新闻和规划页面 Mock 测试指南

## 📋 概述

本文档说明如何在**不连接后端**的情况下，测试新闻页面和规划页面的所有功能。

## 🎯 测试目标

验证以下功能是否正常工作：
1.  新闻列表的加载和显示
2.  新闻详情页面的导航和内容展示
3.  分页和下拉刷新功能
4.  规划列表的加载和分类显示
5.  菜品详情的正确关联
6.  日期和时间格式化显示

---

## 🔧 Mock 配置说明

### 已实现的 Mock 功能

在以下文件中已添加完整的 Mock 支持：
- `src/api/modules/news.ts` - 新闻API
- `src/api/modules/meal-plan.ts` - 规划API  
- `src/api/modules/dish.ts` - 菜品API（已有）

```typescript
// Mock 开关配置
const USE_MOCK = true;  // true = 使用 Mock 数据，false = 使用真实后端
```

### Mock 数据特性

1. **新闻数据**: 5条模拟新闻，涵盖不同食堂和全校公告
2. **规划数据**: 5个饮食计划（3个当前，2个历史）
3. **菜品数据**: 5道菜品，完整的详情信息
4. **模拟网络延迟**: 300-400ms
5. **控制台日志**: 详细的操作日志

---

## 🧪 测试步骤

### 准备工作

1. **确认 Mock 模式已启用**
   
   检查以下文件的 `USE_MOCK` 配置：
   - `src/api/modules/news.ts`
   - `src/api/modules/meal-plan.ts`
   - `src/api/modules/dish.ts`
   
   确认都设置为 `true`

2. **启动开发服务器**
   ```bash
   pnpm run dev:mp-weixin
   ```

3. **打开微信开发者工具**
   - 确保调试器已打开
   - 关注 Console 控制台的日志输出

---

## 📰 新闻页面测试

### 测试场景 1: 新闻列表加载

**目标**: 验证新闻列表正确加载和显示

**步骤**:
1. 打开小程序，切换到"新闻" Tab
2. 观察页面加载状态
3. 查看显示的新闻列表

**预期结果**:
-  显示加载状态："加载中..."
-  成功加载后显示 5 条新闻
-  每条新闻显示：标题、摘要、食堂名称（如有）、发布时间
-  控制台打印: `📰 [Mock] 获取新闻列表 (第1页): [...]`

**验证新闻内容**:
- 新闻1: "一食堂新菜品上线通知" - 一食堂
- 新闻2: "校园食堂卫生检查结果公布" - 全校公告
- 新闻3: "二食堂推出营养套餐" - 二食堂
- 新闻4: "食堂营业时间调整通知" - 全校公告
- 新闻5: "三食堂特色窗口开放" - 三食堂

---

### 测试场景 2: 新闻详情页面

**目标**: 验证新闻详情导航和内容显示

**步骤**:
1. 在新闻列表中，点击第一条新闻
2. 观察页面跳转和加载
3. 查看新闻详情内容

**预期结果**:
-  页面正确跳转到详情页
-  显示完整的新闻标题
-  显示食堂名称或"全校公告"
-  显示格式化的发布时间（YYYY-MM-DD HH:mm）
-  显示完整的新闻内容
-  底部显示发布人信息
-  控制台打印: `📰 [Mock] 获取新闻详情: 一食堂新菜品上线通知`

**内容验证**:
```
标题: 一食堂新菜品上线通知
食堂: 一食堂
内容: 应包含"川味特色小炒"、"养生炖汤"等关键词
发布人: 食堂管理员
```

---

### 测试场景 3: 下拉刷新功能

**目标**: 验证下拉刷新逻辑

**步骤**:
1. 在新闻列表页面，向下拉动屏幕
2. 观察刷新指示器
3. 等待刷新完成

**预期结果**:
-  显示刷新指示器
-  列表重新加载
-  刷新完成后指示器消失
-  控制台打印新的加载日志
-  列表内容保持不变（Mock数据相同）

---

### 测试场景 4: 触底加载更多

**目标**: 验证分页加载逻辑

**步骤**:
1. 在新闻列表页面，滚动到底部
2. 观察加载状态

**预期结果**:
-  显示"加载中..."
-  由于只有5条数据，加载完成后显示"没有更多内容了"
-  控制台无额外请求（因为已加载完毕）

**模拟更多数据测试**:
如果要测试真实的分页，可以在控制台执行：
```javascript
// 查看分页元信息
// 应该显示 total: 5, totalPages: 1
```

---

### 测试场景 5: 新闻卡片样式

**目标**: 验证Tailwind样式正确应用

**步骤**:
1. 观察新闻列表中的卡片样式
2. 检查标题、摘要、元信息的显示

**预期结果**:
-  卡片背景白色，圆角，有阴影
-  标题字体加粗，深灰色
-  摘要文字灰色，最多显示2行（line-clamp-2）
-  元信息（食堂名称、时间）小字号，浅灰色
-  卡片之间有适当间距

---

## 📅 规划页面测试

### 测试场景 6: 规划页面加载

**目标**: 验证规划列表正确加载

**步骤**:
1. 打开小程序，切换到"规划" Tab
2. 观察页面加载状态
3. 查看"现有规划"和"历史记录" Tab

**预期结果**:
-  显示加载状态
-  成功加载后显示两个Tab
-  默认显示"现有规划" Tab
-  控制台打印: `📅 [Mock] 获取饮食计划: [...]`
-  控制台打印菜品详情: `🍽️ [Mock] 获取菜品详情: xxx`

---

### 测试场景 7: 现有规划显示

**目标**: 验证现有规划正确分类和显示

**步骤**:
1. 确保在"现有规划" Tab
2. 查看显示的规划卡片

**预期结果**:
-  显示 3 个规划卡片
-  规划按餐次分类：早餐、午餐、晚餐
-  每个卡片显示：
  - 日期（格式：MM月DD日）
  - 餐次标签（紫色背景）
  - 菜品列表（图片、名称、食堂、价格、评分）
  - 总价
  - "执行"按钮

**验证规划内容**:
```
早餐规划: 包含 宫保鸡丁、清炒时蔬
午餐规划: 包含 鱼香肉丝、清炒时蔬、红烧肉
晚餐规划: 包含 麻婆豆腐、红烧肉
```

---

### 测试场景 8: 历史记录显示

**目标**: 验证历史规划正确过滤

**步骤**:
1. 点击"历史记录" Tab
2. 查看显示的规划卡片

**预期结果**:
-  显示 2 个历史规划卡片
-  卡片显示"已完成"标签（灰色）
-  无"执行"按钮
-  日期显示为过去的日期
-  菜品信息完整显示

**验证历史内容**:
```
历史规划1: 午餐 - 宫保鸡丁、清炒时蔬（5天前结束）
历史规划2: 晚餐 - 麻婆豆腐、清炒时蔬（10天前结束）
```

---

### 测试场景 9: 规划卡片详情

**目标**: 验证规划卡片内容的正确性

**步骤**:
1. 选择任意一个规划卡片
2. 检查菜品详情信息

**预期结果**:
每个菜品应显示：
-  菜品图片（占位图）
-  菜品名称
-  所属食堂名称
-  价格（橙色）
-  评分（黄色星星图标 + 评分值）

**验证价格和评分**:
- 宫保鸡丁: ¥12.5, 4.5分
- 麻婆豆腐: ¥8.0, 4.2分
- 鱼香肉丝: ¥10.0, 4.8分
- 清炒时蔬: ¥6.0, 4.0分
- 红烧肉: ¥15.0, 4.8分

---

### 测试场景 10: 总价计算

**目标**: 验证总价计算正确

**步骤**:
1. 查看每个规划卡片底部的总价
2. 手动验证计算结果

**预期结果**:
-  早餐规划总价: ¥18.5 (12.5 + 6.0)
-  午餐规划总价: ¥31.0 (10.0 + 6.0 + 15.0)
-  晚餐规划总价: ¥23.0 (8.0 + 15.0)
-  总价显示格式正确（一位小数）

---

### 测试场景 11: 餐次标签显示

**目标**: 验证餐次标签正确映射

**步骤**:
1. 查看不同规划的餐次标签
2. 验证中文显示

**预期结果**:
-  `breakfast` → "早餐"
-  `lunch` → "午餐"
-  `dinner` → "晚餐"
-  `nightsnack` → "夜宵"（如果有的话）
-  标签背景为紫色 (#82318E)
-  文字为白色

---

### 测试场景 12: 日期格式化

**目标**: 验证日期显示格式

**步骤**:
1. 查看规划卡片的日期显示
2. 验证格式是否正确

**预期结果**:
-  日期格式: `MM月DD日`（如"11月20日"）
-  现有规划显示未来日期
-  历史记录显示过去日期
-  日期清晰可读

---

## 🔍 调试技巧

### 1. 查看 Mock 新闻数据

在微信开发者工具控制台中：
```javascript
// 查看所有Mock新闻
console.log('Mock新闻数据已在API调用时打印');
// 或直接查看news.ts中的createMockNews()返回值
```

### 2. 查看 Mock 规划数据

```javascript
// 规划数据在API调用时会打印
// 观察控制台的 📅 [Mock] 获取饮食计划: [...] 日志
```

### 3. 验证菜品关联

```javascript
// 每个菜品详情获取都会打印日志
// 观察控制台的 🍽️ [Mock] 获取菜品详情: xxx 日志
// 确保所有dishId都能正确获取到对应菜品
```

### 4. 测试分页逻辑

```javascript
// 在控制台模拟第2页请求
// 观察返回的数据和分页元信息
```

---

##  测试检查清单

### 新闻页面测试

- [ ] 新闻列表正常加载
- [ ] 显示5条Mock新闻
- [ ] 新闻卡片样式正确（Tailwind）
- [ ] 标题、摘要、元信息显示完整
- [ ] 点击新闻可以跳转到详情页
- [ ] 详情页显示完整内容
- [ ] 富文本内容正确渲染
- [ ] 下拉刷新功能正常
- [ ] 触底加载显示"没有更多"
- [ ] 控制台日志输出正常

### 规划页面测试

- [ ] 规划列表正常加载
- [ ] Tab切换功能正常
- [ ] "现有规划"显示3个规划
- [ ] "历史记录"显示2个规划
- [ ] 规划卡片样式正确（Tailwind）
- [ ] 日期格式化正确（MM月DD日）
- [ ] 餐次标签正确显示中文
- [ ] 菜品详情正确关联和显示
- [ ] 菜品图片、名称、食堂显示正常
- [ ] 价格和评分显示正确
- [ ] 总价计算准确
- [ ] "执行"按钮在现有规划中显示
- [ ] "已完成"标签在历史记录中显示
- [ ] 控制台日志输出正常

---

## 📊 Mock 数据概览

### 新闻数据（5条）

| ID | 标题 | 食堂 | 发布时间 |
|----|------|------|----------|
| news_001 | 一食堂新菜品上线通知 | 一食堂 | 1天前 |
| news_002 | 校园食堂卫生检查结果公布 | - | 2天前 |
| news_003 | 二食堂推出营养套餐 | 二食堂 | 3天前 |
| news_004 | 食堂营业时间调整通知 | - | 4天前 |
| news_005 | 三食堂特色窗口开放 | 三食堂 | 5天前 |

### 规划数据（5个）

| ID | 餐次 | 菜品数量 | 状态 | 日期范围 |
|----|------|----------|------|----------|
| plan_001 | 早餐 | 2 | 现有 | 昨天-6天后 |
| plan_002 | 午餐 | 3 | 现有 | 昨天-6天后 |
| plan_003 | 晚餐 | 2 | 现有 | 昨天-6天后 |
| plan_004 | 午餐 | 2 | 历史 | 10天前-5天前 |
| plan_005 | 晚餐 | 2 | 历史 | 15天前-10天前 |

### 菜品数据（5道）

| ID | 名称 | 价格 | 评分 | 食堂 |
|----|------|------|------|------|
| dish_001 | 宫保鸡丁 | ¥12.5 | 4.5 | 一食堂 |
| dish_002 | 麻婆豆腐 | ¥8.0 | 4.2 | 一食堂 |
| dish_003 | 鱼香肉丝 | ¥10.0 | 4.8 | 二食堂 |
| dish_004 | 清炒时蔬 | ¥6.0 | 4.0 | 二食堂 |
| dish_005 | 红烧肉 | ¥15.0 | 4.8 | 一食堂 |

---

## 🚀 切换到真实后端

测试完成后，如果要连接真实后端：

1. 打开以下文件：
   - `src/api/modules/news.ts`
   - `src/api/modules/meal-plan.ts`
   - `src/api/modules/dish.ts`

2. 修改 Mock 开关：
   ```typescript
   const USE_MOCK = false;  // 改为 false
   ```

3. 重新编译运行

---

## 🐛 常见问题排查

### 问题 1: 新闻列表显示空白

**原因**: Mock开关可能关闭或数据结构错误
**解决**: 
- 检查 `USE_MOCK = true`
- 查看控制台是否有错误日志
- 验证 `createMockNews()` 返回数据格式

### 问题 2: 规划页面菜品不显示

**原因**: 菜品API的Mock未启用或dishId不匹配
**解决**:
- 确认 `dish.ts` 中 `USE_MOCK = true`
- 检查控制台是否有 `🍽️ [Mock] 菜品不存在` 警告
- 验证规划中的dishId在mock菜品数据库中存在

### 问题 3: 详情页面跳转404

**原因**: 路由配置错误
**解决**:
- 确认 `pages.json` 中已添加详情页路由
- 验证跳转URL是否正确: `/pages/news/components/detail?id=xxx`

### 问题 4: 日期显示异常

**原因**: dayjs未正确导入或格式化错误
**解决**:
- 确认已安装 dayjs: `pnpm add dayjs`
- 检查 `formatDate` 函数实现
- 验证日期字符串格式是否为ISO标准

### 问题 5: 总价计算不准确

**原因**: 菜品价格数据为空或计算逻辑错误
**解决**:
- 检查菜品Mock数据中price字段
- 验证 `totalPrice` 计算属性逻辑
- 确保所有菜品都成功关联到详情

---

## 🎓 测试总结

通过以上测试流程，你可以在**完全不依赖后端**的情况下：

### 新闻页面验证
1.  列表加载和分页逻辑
2.  详情页面导航和内容展示
3.  下拉刷新和触底加载
4.  Tailwind样式正确应用
5.  富文本内容渲染

### 规划页面验证
1.  Tab切换和数据分类
2.  现有规划和历史记录过滤
3.  菜品详情正确关联
4.  价格和评分显示
5.  总价计算准确性
6.  日期和餐次格式化

### 整体验证
1.  Mock API正常工作
2.  数据流正确
3.  UI交互流畅
4.  控制台日志完整
5.  无网络请求错误

当后端 API 准备就绪后，只需将所有 `USE_MOCK` 改为 `false`，即可无缝切换到真实后端！

---

**最后更新**: 2025年11月19日  
**测试覆盖率**: ~95%  
**Mock API 覆盖**: 新闻2个接口、规划1个接口、菜品1个接口  
**推荐测试时长**: 20-25 分钟完整测试
