# =============================================================================
# TasteInsight Backend - Environment Configuration
# =============================================================================
# Copy this file to .env and fill in the values.
# This file is used for both local development and Docker deployment.
#
# Usage:
#   Local development: cp .env.example .env
#   Docker: docker compose up (reads .env automatically)
# =============================================================================

# --- Application ---
APP_PORT=3000
APP_URL="http://localhost:${APP_PORT}"

# --- Initial Superadmin ---
# Only used when no admins exist in the database
INITIAL_ADMIN_USERNAME=your_admin_username
INITIAL_ADMIN_PASSWORD=your_secure_password

# --- Database Configuration ---
POSTGRES_HOST=your_postgres_host
POSTGRES_PORT=your_postgres_port
POSTGRES_USER=your_postgres_user
POSTGRES_PASSWORD=your_postgres_password
POSTGRES_DB=your_postgres_db
# Docker Compose 需要一个固定值，需要手动修改
DATABASE_URL="postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:${POSTGRES_PORT}/${POSTGRES_DB}?schema=public"

# --- JWT ---
JWT_SECRET=your-super-secret-key-that-is-long-and-random
JWT_EXPIRATION_TIME=3600s
JWT_REFRESH_SECRET=another-super-secret-for-refresh-token
JWT_REFRESH_EXPIRATION_TIME=7d

# --- WeChat Mini Program ---
WECHAT_APPID=your_wechat_appid
WECHAT_SECRET=your_wechat_appsecret

# --- Upload Configuration ---
UPLOAD_STORAGE_TYPE=local       # local | oss
UPLOAD_LOCAL_PATH=./uploads     # 本地存储路径
UPLOAD_BASE_URL="${APP_URL}/images" # 图片访问的基础 URL
UPLOAD_MAX_FILE_SIZE=10485760   # 最大文件大小（字节），默认 10MB

# --- Redis Configuration (for BullMQ async task queue and cache) ---
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=your_secure_redis_password_here

# --- OSS (Optional, only if UPLOAD_STORAGE_TYPE=oss) ---
OSS_REGION=oss-cn-hangzhou
OSS_ACCESS_KEY_ID=your-access-key-id
OSS_ACCESS_KEY_SECRET=your-access-key-secret
OSS_BUCKET=your-bucket-name
OSS_CUSTOM_DOMAIN=

# --- Embedding Services Configuration ---
# Python Embedding Service
PYTHON_EMBEDDING_HOST=0.0.0.0
PYTHON_EMBEDDING_PORT=5001
PYTHON_EMBEDDING_DEBUG=false
PYTHON_EMBEDDING_TEXT_MODEL=sentence-transformers/paraphrase-multilingual-mpnet-base-v2
PYTHON_EMBEDDING_DEFAULT_VERSION=v2
PYTHON_EMBEDDING_MODEL_DIR=saved_models
PYTHON_EMBEDDING_DEVICE=  # Leave empty for auto-detection
PYTHON_EMBEDDING_PRELOAD_MODELS=v2,v3

# TS Embedding Service
EXTERNAL_EMBEDDING_SERVICE_ENABLED=false  # Set to true to use external Python service
EXTERNAL_EMBEDDING_SERVICE_URL=http://localhost:5001
EXTERNAL_EMBEDDING_SERVICE_EMBEDDING_DIM=256
EMBEDDING_SERVICE_EMBEDDING_DIM=256
EMBEDDING_SERVICE_BATCH_SIZE=50
EXTERNAL_EMBEDDING_SERVICE_VERSION=v2

# --- AI Chat Configuration ---
AI_PROVIDER=openai
AI_API_KEY=your_openai_api_key_here
AI_MODEL=gpt-4o-mini
AI_BASE_URL=  # Optional, leave empty to use default OpenAI endpoint

# --- Docker Only ---
# Set to true to run seed script on first startup
RUN_SEED=false
# 是否导入食堂 Excel 数据 (import_canteens.ts)
IMPORT_DATA=false
